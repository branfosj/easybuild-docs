
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.easybuild.io/containers/">
      
      <link rel="icon" href="../favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Generating container recipes & images {: #containers } - EasyBuild - building software with ease</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../stylesheets/asciinema-player-2.6.1.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-BLVCH6991S"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-BLVCH6991S",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-BLVCH6991S",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="easybuild" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#containers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EasyBuild - building software with ease" class="md-header__button md-logo" aria-label="EasyBuild - building software with ease" data-md-component="logo">
      
  <img src="../img/easybuild_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EasyBuild - building software with ease
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generating container recipes & images {: #containers }
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/easybuilders/easybuild-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EasyBuild @ GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EasyBuild - building software with ease" class="md-nav__button md-logo" aria-label="EasyBuild - building software with ease" data-md-component="logo">
      
  <img src="../img/easybuild_logo.png" alt="logo">

    </a>
    EasyBuild - building software with ease
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/easybuilders/easybuild-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EasyBuild @ GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../what-is-easybuild/" class="md-nav__link">
        What is EasyBuild?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../using-easybuild/" class="md-nav__link">
        Using EasyBuild
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/" class="md-nav__link">
        Release notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-help/" class="md-nav__link">
        Getting help
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/easybuilders/easybuild-docs/easybuild-docs/edit/main/docs/containers.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="containers">Generating container recipes &amp; images<a class="headerlink" href="#containers" title="Permanent link">&para;</a></h1>
<p>EasyBuild has support for generating Singularity and Docker <em>container
recipes</em> which will use EasyBuild to build and install a specified
software stack. In addition, EasyBuild can (optionally) leverage the
build tool provided by the container software of choice to create
<em>container images</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The features documented here have been available since EasyBuild v3.6.0 but are still <em>experimental</em>,<br />
which implies they are subject to change in upcoming versions of
EasyBuild.</p>
<p><strong>You will need to enable the</strong> <code>--experimental</code> <strong>configuration option
in order to use them.</strong></p>
<p>See <a class="autorefs autorefs-internal" href="../experimental-features/#experimental_features">Experimental features</a> for
more information.</p>
</div>
<p>Initially (since EasyBuild v3.6.0), only Singularity
(<a href="https://www.sylabs.io/singularity">https://www.sylabs.io/singularity</a>) was supported. Since EasyBuild
v3.6.2, generating (recipes for) Docker (<a href="https://www.docker.com/">https://www.docker.com/</a>)
containers is also supported.</p>
<p>In EasyBuild v3.9.2 the support for generating Singularity container
recipes/images was enhanced significantly.</p>
<h2 id="containers_req">Requirements<a class="headerlink" href="#containers_req" title="Permanent link">&para;</a></h2>
<ul>
<li>Docker, or Singularity version 2.4 (or more recent, incl. version 3.x)</li>
<li><code>sudo</code> permissions <em>(only required to actually build container images,
  see <a class="autorefs autorefs-internal" href="#containers_usage_build_image">Building container images</a>)</em></li>
</ul>
<h2 id="containers_usage">Usage<a class="headerlink" href="#containers_usage" title="Permanent link">&para;</a></h2>
<h3 id="containers_usage_containerize">Generating container recipes<a class="headerlink" href="#containers_usage_containerize" title="Permanent link">&para;</a></h3>
<p><em>(<code>--containerize</code> / <code>-C</code>)</em></p>
<p>To generate container recipes, use <code>eb --containerize</code>, or <code>eb -C</code> for
short.</p>
<p>The resulting container recipe will, in turn, leverage EasyBuild to
build and install the software that corresponds to the easyconfig files
that are specified as arguments to the <code>eb</code> command (and all required
dependencies, if needed).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EasyBuild will refuse to overwrite existing container recipes.</p>
<p>To re-generate an already existing recipe file, use the <code>--force</code>
command line option.</p>
</div>
<h3 id="containers_usage_template_recipe">Container template recipe<a class="headerlink" href="#containers_usage_template_recipe" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-template-recipe</code>)</em></p>
<p>Via the <code>--container-template-recipe</code> configuration option, you can
specify a specific container template recipe that EasyBuild should use
to generate container recipes.</p>
<p>This gives you control over a variety of aspects, including:</p>
<ul>
<li>the operating system (version) used in the container image</li>
<li>the location where EasyBuild installs software within the container</li>
<li>how EasyBuild is configured when installing software in the container</li>
<li>etc.</li>
</ul>
<p>When generating container recipes, EasyBuild will replace the following
template values:</p>
<ul>
<li><code>%(bootstrap)s</code>: bootstrap agent to use<ul>
<li>see also <a href="https://www.sylabs.io/guides/latest/user-guide/definition_files.html#header">https://www.sylabs.io/guides/latest/user-guide/definition_files.html#header</a></li>
</ul>
</li>
<li><code>%(bootstrap_config)s</code>: configuration for the bootstrap agent<ul>
<li>this is expected to include lines that specify <code>From:</code>, <code>MirrorURL:</code>, etc.</li>
<li>for more information, see <a class="autorefs autorefs-internal" href="#containers_usage_config">Container configuration</a></li>
</ul>
</li>
<li><code>%(easyconfigs)s</code>: (list of) easyconfig file name(s)/path(s) to pass to <code>eb</code> command</li>
<li><code>%(eb_args)s</code>: additional arguments for 'eb' command</li>
<li><code>%(include)s</code>: list of additional OS packages to include<ul>
<li>see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_include">include keyword: OS packages to include</a></li>
</ul>
</li>
<li><code>%(install_eb)s</code>: list of commands to install EasyBuild</li>
<li><code>%(install_os_deps)s</code>: list of commands to install required OS packages (for example <code>yum install -y openssl</code>)<ul>
<li>incl. <code>osdependencies</code> specified in easyconfig files</li>
</ul>
</li>
<li><code>%(mirrorurl)</code>: URI to use to download OS<ul>
<li>see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_mirrorurl">mirrorurl keyword: mirror URL to use to download OS</a></li>
</ul>
</li>
<li><code>%(modname)s</code>: module name(s) to load in environment</li>
<li><code>%(osversion)</code>: OS version to use<ul>
<li>see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_osversion">osversion keyword: OS version to use</a></li>
</ul>
</li>
<li><code>%(post_commands)s</code>: additional commands for the <code>post</code> section of the
  (Singularity) container recipe</li>
</ul>
<h3 id="containers_usage_config">Container configuration<a class="headerlink" href="#containers_usage_config" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-config</code>)</em></p>
<p>Using <code>--container-config</code>, values for specific template values can be
specified.</p>
<p>Values can be specified as a comma-separated list of <code>&lt;key&gt;=&lt;value&gt;</code>
pairs; for example:
<code>--container-config bootstrap=localimage,from:example.sif</code>.</p>
<p>Currently supported keywords include:</p>
<ul>
<li><code>bootstrap</code>: bootstrap agent to use<ul>
<li>two types of values are supported:<ul>
<li><a class="autorefs autorefs-internal" href="#container_bootstrap_agent_image_based">Image-based bootstrap agents</a></li>
<li><a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro">Linux distro bootstrap agents</a></li>
</ul>
</li>
</ul>
</li>
<li><code>eb_args</code>: additional arguments for 'eb' command</li>
<li><code>from</code>: argument to pass to bootstrap agent<ul>
<li><em>required/only valid with</em> <code>docker</code>, <code>library</code>, <code>localimage</code> <em>and</em>
    <code>shub</code> <em>bootstrap agents</em></li>
<li>for more details, see <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_image_based">Image-based bootstrap agents</a></li>
</ul>
</li>
<li><code>include</code>: list of additional OS packages to include<ul>
<li>see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_include">include keyword: OS packages to include</a></li>
</ul>
</li>
<li><code>install_eb</code>: commands to install EasyBuild</li>
<li><code>mirrorurl</code>: URI to use to download OS<ul>
<li>see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_mirrorurl">mirrorurl keyword: mirror URL to use to download OS</a></li>
</ul>
</li>
<li><code>osversion</code>: OS version to use<ul>
<li>see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_osversion">osversion keyword: OS version to use</a></li>
</ul>
</li>
<li><code>post_commands</code>: additional commands for <code>post</code> section of
  (Singularity) container recipe</li>
</ul>
<p>For more details on the last three, see <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro">Linux distro bootstrap agents</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Specifying any unknown keywords will results in an error.</p>
</div>
<h4 id="container_bootstrap_agent_image_based">Image-based bootstrap agents<a class="headerlink" href="#container_bootstrap_agent_image_based" title="Permanent link">&para;</a></h4>
<p><em>(e.g. <code>docker</code>, <code>library</code>, <code>localimage</code>, <code>shub</code>)</em></p>
<p>These bootstrap agents involve using an existing container image as a
base.</p>
<p>Supported values include:</p>
<ul>
<li><code>docker</code>: base container image hosted on Docker Hub
  (<a href="https://hub.docker.com/">https://hub.docker.com/</a>)</li>
<li><code>library</code>: base container image hosted on Sylabs Container Library
  (<a href="https://cloud.sylabs.io/">https://cloud.sylabs.io/</a>)</li>
<li><code>localimage</code>: local base container image file</li>
<li><code>shub</code>: base container image hosted on Singularity Hub
  (<a href="https://singularity-hub.org/">https://singularity-hub.org/</a>)</li>
</ul>
<p><strong>The</strong> <code>from</code> <strong>keyword must also be specified when using one of these
bootstrap agents.</strong></p>
<p>The <code>localimage</code> bootstrap agents corresponds to using a local container
image file as a base, where it's path is specified using the <code>from</code>
keyword. For example:
"<code>bootstrap=localimage,from=/home/example/base.sif</code>".</p>
<p>Each of the other image-based bootstrap agents imply that the container
image to use as a base is downloaded from the corresponding registry, ad
specified through the <code>from</code> keyword, with a specific format:</p>
<ul>
<li>for <code>docker</code> bootstrap agent: <code>&lt;registry&gt;/&lt;namespace&gt;/&lt;container&gt;:&lt;tag&gt;@&lt;digest&gt;</code></li>
<li>for <code>library</code> bootstrap agent: <code>&lt;entity&gt;/&lt;collection&gt;/&lt;container&gt;:&lt;tag&gt;</code></li>
<li>for <code>shub</code> bootstrap agent: <code>&lt;registry&gt;/&lt;username&gt;/&lt;container-name&gt;:&lt;tag&gt;@digest</code></li>
</ul>
<p>For more details, see
<a href="https://www.sylabs.io/guides/latest/user-guide/appendix.html#build-modules">https://www.sylabs.io/guides/latest/user-guide/appendix.html#build-modules</a>.</p>
<h5 id="containers_usage_container_base_image_requirements">Requirements for base container image<a class="headerlink" href="#containers_usage_container_base_image_requirements" title="Permanent link">&para;</a></h5>
<p>There are a couple of specific requirements for the base container
image:</p>
<ul>
<li>all dependencies of EasyBuild must be installed, including:<ul>
<li>Python 2.7 or 3.6+</li>
<li>Lmod</li>
<li>standard tools &amp; utilities like <code>make</code>, <code>patch</code>, <code>tar</code>, etc.</li>
<li>OS packages for system libraries like OpenSSL</li>
</ul>
</li>
</ul>
<p>See also <a class="autorefs autorefs-internal" href="../installation/#requirements">Requirements</a></p>
<p>Each generated container recipe will include commands to create the
<code>easybuild</code> user if it doesn't exist yet, as well as commands to create
the <code>/app</code> and <code>/scratch</code> directories and give the <code>easybuild</code> user
write permissions to those locations.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The generated container recipe currently hardcodes some of this.<br />
We intend to make this more configurable in a future version of
EasyBuild.</p>
</div>
<h4 id="container_bootstrap_agent_linux_distro">Linux distro bootstrap agents<a class="headerlink" href="#container_bootstrap_agent_linux_distro" title="Permanent link">&para;</a></h4>
<p><em>(e.g. <code>arch</code>, <code>busybox</code>, <code>debootstrap</code>, <code>yum</code>, <code>zypper</code>)</em></p>
<p>Dedicated bootstrap agents are supported for different flavors of Linux
distributions, including:</p>
<ul>
<li><code>arch</code>: Arch Linux</li>
<li><code>busybox</code>: BusyBox Linux</li>
<li><code>debootstrap</code>: apt-based systems like Ubuntu/Debian</li>
<li><code>yum</code>: yum-based systems like CentOS</li>
<li><code>zypper</code>: zypper-based systems like openSUSE</li>
</ul>
<p>When one of these bootstrap agents is used, additional keywords can be
specified:</p>
<ul>
<li><a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_include">include keyword: OS packages to include</a></li>
<li><a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_mirrorurl">mirrorurl keyword: mirror URL to use to download OS</a></li>
<li><a class="autorefs autorefs-internal" href="#container_bootstrap_agent_linux_distro_osversion">osversion keyword: OS version to use</a></li>
</ul>
<h5 id="container_bootstrap_agent_linux_distro_include"><code>include</code> keyword: OS packages to include<a class="headerlink" href="#container_bootstrap_agent_linux_distro_include" title="Permanent link">&para;</a></h5>
<p>Via the <code>include</code> keywords, a list of packages can be specified that
should be include on top of the base OS installation.</p>
<p>For some bootstrap agents, a default value is used if no value is
specified:</p>
<ul>
<li>for the <code>yum</code> bootstrap agent: <code>yum</code></li>
<li>for the <code>zypper</code> bootstrap agent: <code>zypper</code></li>
</ul>
<p>See also
<a href="https://www.sylabs.io/guides/latest/user-guide/appendix.html#yum-bootstrap-agent">https://www.sylabs.io/guides/latest/user-guide/appendix.html#yum-bootstrap-agent</a>
and
<a href="https://www.sylabs.io/guides/latest/user-guide/appendix.html#zypper-bootstrap-agent">https://www.sylabs.io/guides/latest/user-guide/appendix.html#zypper-bootstrap-agent</a>.</p>
<h5 id="container_bootstrap_agent_linux_distro_mirrorurl"><code>mirrorurl</code> keyword: mirror URL to use to download OS<a class="headerlink" href="#container_bootstrap_agent_linux_distro_mirrorurl" title="Permanent link">&para;</a></h5>
<p>For most of the Linux distro bootstrap agents (all except <code>arch</code>),
Singularity requires that a mirror URL is specified that will be used
when downloading the corresponding OS.</p>
<p>You can specify a value using the <code>mirrorurl</code> keyword. For example:
"<code>bootstrap=yum,mirrorurl=https://example.com</code>".</p>
<p>EasyBuild will use a default value for <code>mirrorurl</code> if no other value is
specified:</p>
<ul>
<li><code>busybox</code>:
  <code>https://www.busybox.net/downloads/binaries/%{OSVERSION}/busybox-x86_64</code></li>
<li><code>debootstrap</code>: <code>http://us.archive.ubuntu.com/ubuntu/</code></li>
<li><code>yum</code>:
  <code>http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/x86_64/</code></li>
<li><code>zypper</code>::
  <code>http://download.opensuse.org/distribution/leap/%{OSVERSION}/repo/oss/</code></li>
</ul>
<h5 id="container_bootstrap_agent_linux_distro_osversion"><code>osversion</code> keyword: OS version to use<a class="headerlink" href="#container_bootstrap_agent_linux_distro_osversion" title="Permanent link">&para;</a></h5>
<p>Using the <code>osversion</code> keyword you can specify which OS version should be
installed.</p>
<p>Note that is this only required/used if value for the <code>mirrorurl</code> value
contains <code>%{OSVERSION}s</code>.</p>
<p>For example: "<code>bootstrap=yum,osversion=7</code>".</p>
<h3 id="containers_usage_build_image">Building container images<a class="headerlink" href="#containers_usage_build_image" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-build-image</code>)</em></p>
<p>To instruct EasyBuild to also build a container image from the generated
container recipe, use <code>--container-build-image</code> (in combination with
<code>-C</code> or <code>--containerize</code>).</p>
<p>EasyBuild will leverage functionality provided by the container software
of choice (see <a class="autorefs autorefs-internal" href="#containers_cfg_type">Type of container recipe/image to generate</a>) to build the
container image.</p>
<p>For example, in the case of Singularity, EasyBuild will run
<code>sudo /path/to/singularity build</code> on the generated container recipe.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to leverage the image building functionality of the container software, admin privileges are<br />
typically required. Therefore, EasyBuild will run the command to build
the container image with <code>sudo</code>. You may need to enter your password to
let the command execute.</p>
<p>EasyBuild will only run the actual container image build command with
<code>sudo</code>. It will not use elevated privileges for anything else.</p>
<p>In case of doubt, you can use <code>--extended-dry-run</code> or <code>-x</code> do perform a
dry run, so you can evaluate which commands will be executed (see also
<a class="autorefs autorefs-internal" href="../extended-dry-run/#extended_dry_run">Extended dry run</a>.</p>
<p>If you're not comfortable with this, you can just let EasyBuild generate
the container recipe, and then use that to build the actual container
images yourself, either locally or through Singularity Hub
(<a href="https://singularity-hub.org">https://singularity-hub.org</a>).</p>
</div>
<p>The container image will be placed in the location specified by the
<code>--containerpath</code> configuration option (see <a class="autorefs autorefs-internal" href="#containers_cfg_path">Location for generated container recipes &amp; images</a>),
next to the generated container recipe that was used to build the image.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When building container images, make sure to use a file system location
with sufficient available storage space. Singularity may pull metadata
during the build, and each image can range from several hundred MBs to
GBs, depending on software stack you are including in the container
image.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>EasyBuild will refuse to overwrite existing container images.</p>
<p>To re-generate an already existing image file, use the <code>--force</code>
command line option.</p>
</div>
<h3 id="containers_usage_example">Example usage<a class="headerlink" href="#containers_usage_example" title="Permanent link">&para;</a></h3>
<p>In this example, we will use a pre-built base container image located at
<code>example.sif</code> (see also <a class="autorefs autorefs-internal" href="#container_bootstrap_agent_image_based">Image-based bootstrap agents</a>).</p>
<p>To let EasyBuild generate a container recipe for GCC 6.4.0 + binutils
2.28:</p>
<div class="highlight"><pre><span></span><code>eb GCC-6.4.0-2.28.eb --containerize --container-config <span class="nv">bootstrap</span><span class="o">=</span>localimage,from<span class="o">=</span>example.sif --experimental
</code></pre></div>
<p>With other configuration options left to default (see output of
<code>eb --show-config</code>), this will result in a Singularity container recipe
using <code>example.sif</code> as base image, which will be stored in
<code>$HOME/.local/easybuild/containers</code>:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>eb GCC-6.4.0-2.28.eb --containerize --container-config <span class="nv">bootstrap</span><span class="o">=</span>localimage,from<span class="o">=</span>example.sif --experimental
<span class="go">== temporary log file in case of crash /tmp/eb-dLZTNF/easybuild-LPLeG0.log</span>
<span class="go">== Singularity definition file created at /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28</span>
<span class="go">== Temporary log file(s) /tmp/eb-dLZTNF/easybuild-LPLeG0.log* have been removed.</span>
<span class="go">== Temporary directory /tmp/eb-dLZTNF has been removed.</span>
</code></pre></div>
<p>Docker supports a limited set of the container options. Example of
commands that can be used to generate Docker containers are:</p>
<div class="highlight"><pre><span></span><code>eb  --containerize --container-type<span class="o">=</span>docker --experimental --container-config<span class="o">=</span>ubuntu:20.04 zlib-1.2.11.eb
eb  --containerize --container-type<span class="o">=</span>docker --experimental --container-config<span class="o">=</span>centos:7 zlib-1.2.11.eb
</code></pre></div>
<h4 id="containers_example_recipe">Example of a generated container recipe<a class="headerlink" href="#containers_example_recipe" title="Permanent link">&para;</a></h4>
<p>Below is an example of container recipe for that was generated by
EasyBuild, using the following command:</p>
<div class="highlight"><pre><span></span><code>eb Python-3.6.4-foss-2018a.eb -C --container-config <span class="nv">bootstrap</span><span class="o">=</span>yum,osversion<span class="o">=</span><span class="m">7</span> --experimental
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">Bootstrap</span>:<span class="w"> </span>yum
<span class="k">OSVersion</span>:<span class="w"> </span><span class="m">7</span>
<span class="k">MirrorURL</span>:<span class="w"> </span>http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/x86_64/
<span class="k">Include</span>:<span class="w"> </span>yum

<span class="gh">%post</span><span class="w"></span>
yum install --quiet --assumeyes epel-release
yum install --quiet --assumeyes python setuptools Lmod
yum install --quiet --assumeyes python-pip
yum install --quiet --assumeyes bzip2 gzip tar zip unzip xz
yum install --quiet --assumeyes curl wget
yum install --quiet --assumeyes patch make
yum install --quiet --assumeyes file git which
yum install --quiet --assumeyes gcc-c++
yum install --quiet --assumeyes perl-Data-Dumper
yum install --quiet --assumeyes perl-Thread-Queue
yum --skip-broken --quiet --assumeyes install libibverbs-dev libibverbs-devel rdma-core-devel
yum --skip-broken --quiet --assumeyes install openssl-devel libssl-dev libopenssl-devel

<span class="c1"># install EasyBuild using pip</span>
pip install -U setuptools
pip install <span class="s1">&#39;vsc-install&lt;0.11.4&#39;</span> <span class="s1">&#39;vsc-base&lt;2.9.0&#39;</span>
pip install easybuild

<span class="c1"># create &#39;easybuild&#39; user (if missing)</span>
id easybuild <span class="o">||</span> useradd easybuild

<span class="c1"># create /app software installation prefix + /scratch sandbox directory</span>
<span class="k">if</span> <span class="o">[</span> ! -d /app <span class="o">]</span><span class="p">;</span> <span class="k">then</span> mkdir -p /app<span class="p">;</span> chown easybuild:easybuild -R /app<span class="p">;</span> <span class="k">fi</span>
<span class="k">if</span> <span class="o">[</span> ! -d /scratch <span class="o">]</span><span class="p">;</span> <span class="k">then</span> mkdir -p /scratch<span class="p">;</span> chown easybuild:easybuild -R /scratch<span class="p">;</span> <span class="k">fi</span>

<span class="c1"># install Lmod RC file</span>
cat &gt; /etc/lmodrc.lua <span class="s">&lt;&lt; EOF</span>
<span class="s">scDescriptT = {</span>
<span class="s">  {</span>
<span class="s">    [&quot;dir&quot;]       = &quot;/app/lmodcache&quot;,</span>
<span class="s">    [&quot;timestamp&quot;] = &quot;/app/lmodcache/timestamp&quot;,</span>
<span class="s">  },</span>
<span class="s">}</span>
<span class="s">EOF</span>

<span class="c1"># change to &#39;easybuild&#39; user</span>
su - easybuild

<span class="c1"># verbose commands, exit on first error</span>
<span class="nb">set</span> -ve

<span class="c1"># configure EasyBuild</span>

<span class="c1"># use /scratch as general prefix, used for sources, build directories, etc.</span>
<span class="nb">export</span> <span class="nv">EASYBUILD_PREFIX</span><span class="o">=</span>/scratch

<span class="c1"># also use /scratch for temporary directories</span>
<span class="nb">export</span> <span class="nv">EASYBUILD_TMPDIR</span><span class="o">=</span>/scratch/tmp

<span class="c1"># download sources to /scratch/sources, but also consider files located in /tmp/easybuild/sources;</span>
<span class="c1"># that way, source files that can not be downloaded can be seeded in</span>
<span class="nb">export</span> <span class="nv">EASYBUILD_SOURCEPATH</span><span class="o">=</span>/scratch/sources:/tmp/easybuild/sources

<span class="c1"># install software &amp; modules into /app</span>
<span class="nb">export</span> <span class="nv">EASYBUILD_INSTALLPATH</span><span class="o">=</span>/app

<span class="c1"># use EasyBuild to install specified software</span>
eb Python-3.6.4-foss-2018a.eb --robot

<span class="c1"># update Lmod cache</span>
mkdir -p /app/lmodcache
<span class="nv">$LMOD_DIR</span>/update_lmod_system_cache_files -d /app/lmodcache -t /app/lmodcache/timestamp /app/modules/all

<span class="c1"># exit from &#39;easybuild&#39; user</span>
<span class="nb">exit</span>

<span class="c1"># cleanup, everything in /scratch is assumed to be temporary</span>
rm -rf /scratch/*

<span class="gh">%runscript</span><span class="w"></span>
<span class="nb">eval</span> <span class="s2">&quot;</span><span class="nv">$@</span><span class="s2">&quot;</span>

<span class="gh">%environment</span><span class="w"></span>
<span class="c1"># make sure that &#39;module&#39; and &#39;ml&#39; commands are defined</span>
<span class="nb">source</span> /etc/profile
<span class="c1"># increase threshold time for Lmod to write cache in $HOME (which we don&#39;t want to do)</span>
<span class="nb">export</span> <span class="nv">LMOD_SHORT_TIME</span><span class="o">=</span><span class="m">86400</span>
<span class="c1"># purge any modules that may be loaded outside container</span>
module --force purge
<span class="c1"># avoid picking up modules from outside of container</span>
module unuse <span class="nv">$MODULEPATH</span>
<span class="c1"># pick up modules installed in /app</span>
module use /app/modules/all
<span class="c1"># load module(s) corresponding to installed software</span>
module load Python/3.6.4-foss-2018a

<span class="gh">%labels</span><span class="w"></span>
</code></pre></div>
<p>The generated container recipe includes a bunch of <code>yum install</code>
commands to install additional required/useful OS packages,
<code>pip install</code> commands to install EasyBuild (if it's not installed yet),
commands to create the <code>easybuild</code> user and provide write access to the
<code>/app</code> and <code>/scratch</code> directories, and to configure Lmod and update the
Lmod cache after software was installed with EasyBuild.</p>
<p>In addition, the generated module files will follow the default module
naming scheme (<code>EasyBuildMNS</code>). The modules that correspond to the
easyconfig files that were specified on the command line will be loaded
automatically, see the statements in the <code>%environment</code> section of the
generated container recipe.</p>
<h4 id="containers_example_build_image">Example of building container image<a class="headerlink" href="#containers_example_build_image" title="Permanent link">&para;</a></h4>
<p>You can instruct EasyBuild to also build the container image by also
using <code>--container-build-image</code>.</p>
<p>Note that you will need to enter your <code>sudo</code> password (unless you
recently executed a <code>sudo</code> command in the same shell session):</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>eb GCC-6.4.0-2.28.eb --containerize --container-config <span class="nv">bootstrap</span><span class="o">=</span>localimage,from<span class="o">=</span>/tmp/example.sif --container-build-image --experimental
<span class="go">== temporary log file in case of crash /tmp/eb-aYXYC8/easybuild-8uXhvu.log</span>
<span class="go">== Singularity tool found at /usr/bin/singularity</span>
<span class="go">== Singularity version &#39;2.4.6&#39; is 2.4 or higher ... OK</span>
<span class="go">== Singularity definition file created at /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28</span>
<span class="go">== Running &#39;sudo /usr/bin/singularity build  /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28&#39;, you may need to enter your &#39;sudo&#39; password...</span>
<span class="go">== (streaming) output for command &#39;sudo /usr/bin/singularity build  /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28&#39;:</span>
<span class="go">Using container recipe deffile: /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28</span>
<span class="go">Sanitizing environment</span>
<span class="go">Adding base Singularity environment to container</span>
<span class="go">...</span>
<span class="go">== temporary log file in case of crash /scratch/tmp/eb-WnmCI_/easybuild-GcKyY9.log</span>
<span class="go">== resolving dependencies ...</span>
<span class="go">...</span>
<span class="go">== building and installing GCCcore/6.4.0...</span>
<span class="go">...</span>
<span class="go">== building and installing binutils/2.28-GCCcore-6.4.0...</span>
<span class="go">...</span>
<span class="go">== building and installing GCC/6.4.0-2.28...</span>
<span class="go">...</span>
<span class="go">== COMPLETED: Installation ended successfully</span>
<span class="go">== Results of the build can be found in the log file(s) /app/software/GCC/6.4.0-2.28/easybuild/easybuild-GCC-6.4.0-20180424.084946.log</span>
<span class="go">== Build succeeded for 15 out of 15</span>
<span class="go">...</span>
<span class="go">Building Singularity image...</span>
<span class="go">Singularity container built: /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif</span>
<span class="go">Cleaning up...</span>
<span class="go">== Singularity image created at /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif</span>
<span class="go">== Temporary log file(s) /tmp/eb-aYXYC8/easybuild-8uXhvu.log* have been removed.</span>
<span class="go">== Temporary directory /tmp/eb-aYXYC8 has been removed.</span>
</code></pre></div>
<p>The inspect the container image, you can use <code>singularity shell</code> to
start a shell session <em>in</em> the container:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>singularity shell --shell <span class="s2">&quot;/bin/bash --norc&quot;</span> <span class="nv">$HOME</span>/.local/easybuild/containers/GCC-6.4.0-2.28.sif

<span class="go">Singularity GCC-6.4.0-2.28.sif:~&gt; module list</span>

<span class="go">Currently Loaded Modules:</span>
<span class="go">  1) GCCcore/6.4.0   2) binutils/2.28-GCCcore-6.4.0   3) GCC/6.4.0-2.28</span>

<span class="go">Singularity GCC-6.4.0-2.28.sif:~&gt; which gcc</span>
<span class="go">/app/software/GCCcore/6.4.0/bin/gcc</span>

<span class="go">Singularity GCC-6.4.0-2.28.sif:~&gt; gcc --version</span>
<span class="go">gcc (GCC) 6.4.0</span>
<span class="go">...</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are passing <code>--shell "/bin/bash --norc</code> to <code>singularity shell</code> to avoid that the <code>.bashrc</code> login<br />
script that may be present in your home directory is sourced, since that
may include statements that are not relevant in the container
environment.</p>
</div>
<p>Or, you can use <code>singularity exec</code> to execute a command in the
container.</p>
<p>Compare the output of running <code>which gcc</code> and <code>gcc --version</code> locally:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>which gcc
<span class="go">/usr/bin/gcc</span>
<span class="gp">$ </span>gcc --version
<span class="go">gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-16)</span>
<span class="go">...</span>
</code></pre></div>
<p>and the output when running the same commands in the container:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span>singularity <span class="nb">exec</span> GCC-6.4.0-2.28.sif which gcc
<span class="go">/app/software/GCCcore/6.4.0/bin/gcc</span>

<span class="gp">$ </span>singularity <span class="nb">exec</span> GCC-6.4.0-2.28.sif gcc --version
<span class="go">gcc (GCC) 6.4.0</span>
<span class="go">...</span>
</code></pre></div>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can specify each of these configuration options either as options to the <code>eb</code> command,<br />
via the equivalent <code>$EASYBUILD_CONTAINER*</code> environment variable, or via
an EasyBuild configuration file; see <a class="autorefs autorefs-internal" href="../configuration/#configuration_types">Supported configuration types</a>.</p>
</div>
<h3 id="containers_cfg_path">Location for generated container recipes &amp; images<a class="headerlink" href="#containers_cfg_path" title="Permanent link">&para;</a></h3>
<p><em>(<code>--containerpath</code>)</em></p>
<p>To control the location where EasyBuild will put generated container
recipes &amp; images, use the <code>--containerpath</code> configuration setting. Next
to providing this as an option to the <code>eb</code> command, you can also define
the <code>$EASYBUILD_CONTAINERPATH</code> environment variable or specify
<code>containerpath</code> in an EasyBuild configuration file.</p>
<p>The default value for this location is
<code>$HOME/.local/easybuild/containers</code>, unless the <code>--prefix</code> configuration
setting was provided, in which case it becomes <code>&lt;prefix&gt;/containers</code>
(see <a class="autorefs autorefs-internal" href="../configuration/#prefix">Overall prefix path</a>).</p>
<p>Use <code>eb --show-full-config | grep containerpath</code> to determine the
currently active setting.</p>
<h3 id="containers_cfg_image_format">Container image format<a class="headerlink" href="#containers_cfg_image_format" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-image-format</code>)</em></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is only relevant when creating Singularity container images;<br />
the value for <code>--container-image-format</code> is ignored when creating Docker
container images.</p>
</div>
<p>The format for container images that EasyBuild is produces via the
functionality provided by the container software can be controlled via
the <code>--container-image-format</code> configuration setting.</p>
<p>For Singularity containers (see <a class="autorefs autorefs-internal" href="#containers_cfg_type">Type of container recipe/image to generate</a>),
three image formats are supported:</p>
<ul>
<li><code>squashfs</code> <em>(default when using Singularity 2.x)</em>: compressed images
  using <code>squashfs</code> read-only file system</li>
<li><code>sif</code> <em>(default when using Singularity 3.x)</em>: compressed read-only
  Singularity Image File (SIF)</li>
<li><code>ext3</code>: writable image file using <code>ext3</code> file system <em>(only supported
  with Singularity 2.x)</em></li>
<li><code>sandbox</code>: container image in a regular directory</li>
</ul>
<p>See also
<a href="https://www.sylabs.io/guides/latest/user-guide/build_a_container.html">https://www.sylabs.io/guides/latest/user-guide/build_a_container.html</a>
.</p>
<h3 id="containers_cfg_image_name">Name for container recipe &amp; image<a class="headerlink" href="#containers_cfg_image_name" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-image-name</code>)</em></p>
<p>By default, EasyBuild will use the name of the first easyconfig file
(without the <code>.eb</code> suffix) as a name for both the container recipe and
image.</p>
<p>You can specify an altername name using the <code>--container-image-name</code>
configuration setting.</p>
<p>The filename of generated container recipe will be <code>Singularity.&lt;name&gt;</code>.</p>
<p>The filename of the container image will be <code>&lt;name&gt;&lt;extension&gt;</code>, where
the value for <code>&lt;extension&gt;</code> depends on the image format (see
<a class="autorefs autorefs-internal" href="#containers_cfg_image_format">Container image format</a>):</p>
<ul>
<li>'<code>.simg</code>' for <code>squashfs</code> Singularity container images <em>(only with
  Singularity 2.x)</em></li>
<li>'<code>.img</code>' for <code>ext3</code> Singularity container images <em>(only with
  Singularity 2.x)</em></li>
<li>'<code>.sif</code>' for Singularity container images in Singularity Image Format
  (SIF) <em>(only with Singularity 3.x)</em></li>
<li><em>empty</em> for <code>sandbox</code> Singularity container images (in which case the
  container image is actually a directory rather than a file)</li>
<li><em>empty</em> for Docker container images</li>
</ul>
<h3 id="containers_tmpdir">Temporary directory for creating container images<a class="headerlink" href="#containers_tmpdir" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-tmpdir</code>)</em></p>
<p>The container software that EasyBuild leverages to build container
images may be using a temporary directory in a location that doesn't
have sufficient free space.</p>
<p>You can instruct EasyBuild to pass an alternate location via the
<code>--container-tmpdir</code> configuration setting.</p>
<p>For Singularity, the default is to use <code>/tmp</code>, see
<a href="https://www.sylabs.io/guides/latest/user-guide/build_env.html#temporary-folders">https://www.sylabs.io/guides/latest/user-guide/build_env.html#temporary-folders</a>.
If <code>--container-tmpdir</code> is specified, the <code>$SINGULARITY_TMPDIR</code>
environment variable will be defined accordingly to let Singularity use
that location instead.</p>
<h3 id="containers_cfg_type">Type of container recipe/image to generate<a class="headerlink" href="#containers_cfg_type" title="Permanent link">&para;</a></h3>
<p><em>(<code>--container-type</code>)</em></p>
<p>With the <code>--container-type</code> configuration option, you can specify what
type of container recipe/image EasyBuild should generated. Possible
values are:</p>
<ul>
<li><code>docker</code>: Docker (<a href="https://docs.docker.com/">https://docs.docker.com/</a>) container recipe &amp;
  images (supported since EasyBuild v3.6.2)</li>
<li><code>singularity</code> <em>(default)</em>: Singularity
  (<a href="https://www.sylabs.io/singularity">https://www.sylabs.io/singularity</a>) container recipes &amp; images</li>
</ul>
<h2 id="containers_stacking">'Stacking' container images<a class="headerlink" href="#containers_stacking" title="Permanent link">&para;</a></h2>
<p>To avoid long build times and excessive large container images, you can
construct your target container image step-by-step, by first building a
base container image for the compiler toolchain you want to use, and
then using it to build a container images for a particular (set of)
software package(s).</p>
<p>For example, to build a container image for Python 3.6.4 built with the
<code>foss/2018a</code> toolchain:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$ </span><span class="nb">cd</span> /tmp

<span class="gp"># </span>use current directory as location <span class="k">for</span> generated container recipes <span class="p">&amp;</span> images
<span class="gp">$ </span><span class="nb">export</span> <span class="nv">EASYBUILD_CONTAINERPATH</span><span class="o">=</span><span class="nv">$PWD</span>

<span class="gp"># </span>build base container image <span class="k">for</span> OpenMPI + GCC parts of foss/2018a toolchain, on top of CentOS <span class="m">7</span>.4 base image
<span class="gp">$ </span>eb -C --container-build-image OpenMPI-2.1.2-GCC-6.4.0-2.28.eb --container-config <span class="nv">bootstrap</span><span class="o">=</span>yum,osversion<span class="o">=</span><span class="m">7</span> --experimental
<span class="go">...</span>
<span class="go">== Singularity image created at /tmp/OpenMPI-2.1.2-GCC-6.4.0-2.28.sif</span>
<span class="go">...</span>

<span class="gp">$ </span>ls -lh OpenMPI-2.1.2-GCC-6.4.0-2.28.sif
<span class="go">-rwxr-xr-x 1 root root 590M Apr 24 11:43 OpenMPI-2.1.2-GCC-6.4.0-2.28.sif</span>

<span class="gp"># </span>build another container image <span class="k">for</span> the <span class="k">for</span> the full foss/2018a toolchain, using the OpenMPI + GCC container as a base
<span class="gp">$ </span>eb -C --container-build-image foss-2018a.eb --container-config <span class="nv">bootstrap</span><span class="o">=</span>localimage,from<span class="o">=</span>OpenMPI-2.1.2-GCC-6.4.0-2.28.sif --experimental
<span class="go">...</span>
<span class="go">== Singularity image created at /tmp/foss-2018a.sif</span>
<span class="go">...</span>

<span class="gp">$ </span>ls -lh foss-2018a.sif
<span class="go">-rwxr-xr-x 1 root root 614M Apr 24 13:11 foss-2018a.sif</span>

<span class="gp"># </span>build container image <span class="k">for</span> Python <span class="m">3</span>.6.4 with foss/2018a toolchain by leveraging base container image foss-2018a.sif
<span class="gp">$ </span>eb -C --container-build-image Python-3.6.4-foss-2018a.eb --container-config <span class="nv">bootstrap</span><span class="o">=</span>localimage,from<span class="o">=</span>foss-2018a.sif --experimental
<span class="go">...</span>
<span class="go">== Singularity image created at /tmp/Python-3.6.4-foss-2018a.sif</span>
<span class="go">...</span>

<span class="gp">$ </span>ls -lh Python-3.6.4-foss-2018a.sif
<span class="go">-rwxr-xr-x 1 root root 759M Apr 24 14:01 Python-3.6.4-foss-2018a.sif</span>

<span class="gp">$ </span>singularity <span class="nb">exec</span> Python-3.6.4-foss-2018a.sif which python
<span class="go">/app/software/Python/3.6.4-foss-2018a/bin/python</span>

<span class="gp">$ </span>singularity <span class="nb">exec</span> Python-3.6.4-foss-2018a.sif python -V
<span class="go">vsc40023 belongs to gsingularity</span>
<span class="go">Python 3.6.4</span>
</code></pre></div>
<h2 id="containers_seeding">Seeding in source files for container build process<a class="headerlink" href="#containers_seeding" title="Permanent link">&para;</a></h2>
<p>In some cases, you may need to "seed in" manually downloaded source
files into the container build environment, because the sources can not
be downloaded automatically.</p>
<p>As shown in <a class="autorefs autorefs-internal" href="#containers_example_recipe">Example of a generated container recipe</a>, the container recipe
generated by EasyBuild includes <code>/tmp/easybuild/sources/</code> as a fallback
directory in the list of locations considered by EasyBuild when looking
for sources/patches (see also <a class="autorefs autorefs-internal" href="../configuration/#sourcepath">Source path</a>).</p>
<p>That way, you can copy source files that should be available when
building the container image into <code>/tmp/easybuild/sources/</code>.</p>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">November 5, 2022</span>
      
    
  </small>
</div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/easy_build" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/c/easybuilders" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://docs.easybuild.io" target="_blank" rel="noopener" title="docs.easybuild.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["instant", "navigation.top", "toc.integrate"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../js/asciinema-player-2.6.1.js"></script>
      
    
    
  </body>
</html>

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.easybuild.io/containers/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>Generating container recipes & images - EasyBuild - building software with ease</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="easybuild" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#generating-container-recipes-images" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="EasyBuild - building software with ease" class="md-header__button md-logo" aria-label="EasyBuild - building software with ease" data-md-component="logo">
      
  <img src="../img/easybuild_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EasyBuild - building software with ease
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Generating container recipes & images
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/easybuilders/easybuild-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EasyBuild @ GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="EasyBuild - building software with ease" class="md-nav__button md-logo" aria-label="EasyBuild - building software with ease" data-md-component="logo">
      
  <img src="../img/easybuild_logo.png" alt="logo">

    </a>
    EasyBuild - building software with ease
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/easybuilders/easybuild-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    EasyBuild @ GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../what-is-easybuild/" class="md-nav__link">
        What is EasyBuild?
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../terminology/" class="md-nav__link">
        Terminology
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../using-easybuild/" class="md-nav__link">
        Using EasyBuild
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../release-notes/" class="md-nav__link">
        Release notes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        API
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../getting-help/" class="md-nav__link">
        Getting help
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/easybuilders/easybuild-docs/easybuild-docs/edit/main/docs/containers.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="generating-container-recipes-images">Generating container recipes &amp; images<a class="headerlink" href="#generating-container-recipes-images" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This page will soon replace <a href="https://docs.easybuild.io/en/latest/Containers.html">https://docs.easybuild.io/en/latest/Containers.html</a>.</p>
<p><strong>
It still needs to be ported from <em>reStructuredText</em> (.rst) to <em>MarkDown</em> (.md),<br />
and you can help with that!
</strong></p>
<ul>
<li>source: <a href="https://raw.githubusercontent.com/easybuilders/easybuild/develop/docs/Containers.rst"><code>docs/Containers.rst</code> in <code>easybuilders/easybuild</code> repo</a></li>
<li>target: <a href="https://github.com/easybuilders/easybuild-docs/tree/main/docs/containers.md"><code>docs/containers.md</code> in <code>easybuilders/easybuild-docs</code> repo</a></li>
</ul>
<p>See <a href="https://github.com/easybuilders/easybuild-docs">https://github.com/easybuilders/easybuild-docs</a> for more information.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="p">..</span> <span class="nt">_containers:</span>

<span class="gh">Generating container recipes &amp; images</span>
<span class="gh">=====================================</span>

EasyBuild has support for generating Singularity and Docker <span class="ge">*container recipes*</span>
which will use EasyBuild to build and install a specified software stack.
In addition, EasyBuild can (optionally) leverage the build tool provided by the
container software of choice to create <span class="ge">*container images*</span>.

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> The features documented here have been available since EasyBuild v3.6.0 but are still <span class="ge">*experimental*</span>,
          which implies they are subject to change in upcoming versions of EasyBuild.

          <span class="gs">**You will need to enable the**</span> <span class="s">``--experimental``</span> <span class="gs">**configuration option in order to use them.**</span>

          See <span class="na">:ref:</span><span class="nv">`experimental_features`</span> for more information.

Initially (since EasyBuild v3.6.0), only Singularity (https://www.sylabs.io/singularity) was supported.
Since EasyBuild v3.6.2, generating (recipes for) Docker (https://www.docker.com/) containers is also supported.

In EasyBuild v3.9.2 the support for generating Singularity container recipes/images was enhanced significantly.

<span class="p">..</span> <span class="ow">contents</span><span class="p">::</span>
    <span class="nc">:depth:</span> 3
    <span class="nc">:backlinks:</span> none

<span class="p">..</span> <span class="nt">_containers_req:</span>

<span class="gh">Requirements</span>
<span class="gh">------------</span>

<span class="m">*</span> Docker, or Singularity version 2.4 (or more recent, incl. version 3.x)
<span class="m">*</span> <span class="s">``sudo``</span> permissions <span class="ge">*(only required to actually build container images, see*</span> <span class="na">:ref:</span><span class="nv">`containers_usage_build_image`</span> <span class="ge">*)*</span>


<span class="p">..</span> <span class="nt">_containers_usage:</span>

<span class="gh">Usage</span>
<span class="gh">-----</span>

<span class="p">..</span> <span class="nt">_containers_usage_containerize:</span>

<span class="gh">Generating container recipes (``--containerize`` / ``-C``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

To generate container recipes, use <span class="s">``eb --containerize``</span>, or <span class="s">``eb -C``</span> for short.

The resulting container recipe will, in turn, leverage EasyBuild to build and install the software
that corresponds to the easyconfig files that are specified as arguments to the <span class="s">``eb``</span> command
(and all required dependencies, if needed).

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> EasyBuild will refuse to overwrite existing container recipes.

          To re-generate an already existing recipe file, use the <span class="s">``--force``</span> command line option.


<span class="p">..</span> <span class="nt">_containers_usage_template_recipe:</span>

<span class="gh">Container template recipe (``--container-template-recipe``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

Via the <span class="s">``--container-template-recipe``</span> configuration option, you can specify a specific container template recipe
that EasyBuild should use to generate container recipes.

This gives you control over a variety of aspects, including:

<span class="m">*</span> the operating system (version) used in the container image
<span class="m">*</span> the location where EasyBuild installs software within the container
<span class="m">*</span> how EasyBuild is configured when installing software in the container
<span class="m">*</span> etc.

When generating container recipes, EasyBuild will replace the following template values:

<span class="m">*</span> <span class="s">``%(bootstrap)s``</span>: bootstrap agent to use

  <span class="m">*</span> see also https://www.sylabs.io/guides/latest/user-guide/definition_files.html#header

<span class="m">*</span> <span class="s">``%(bootstrap_config)s``</span>: configuration for the bootstrap agent

  <span class="m">*</span> this is expected to include lines that specify <span class="s">``From:``</span>, <span class="s">``MirrorURL:``</span>, etc.
  <span class="m">*</span> for more information, see <span class="na">:ref:</span><span class="nv">`containers_usage_config`</span>

<span class="m">*</span> <span class="s">``%(easyconfigs)s``</span>: (list of) easyconfig file name(s)/path(s) to pass to <span class="s">``eb``</span> command
<span class="m">*</span> <span class="s">``%(eb_args)s``</span>: additional arguments for &#39;eb&#39; command
<span class="m">*</span> <span class="s">``%(include)s``</span>: list of additional OS packages to include

  <span class="m">*</span> see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_include`</span>

<span class="m">*</span> <span class="s">``%(install_eb)s``</span>: list of commands to install EasyBuild
<span class="m">*</span> <span class="s">``%(install_os_deps)s``</span>: list of commands to install required OS packages (for example <span class="s">``yum install -y openssl``</span>)

  <span class="m">*</span> incl. <span class="s">``osdependencies``</span> specified in easyconfig files

<span class="m">*</span> <span class="s">``%(mirrorurl)``</span>: URI to use to download OS

  <span class="m">*</span> see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_mirrorurl`</span>

<span class="m">*</span> <span class="s">``%(modname)s``</span>: module name(s) to load in environment
<span class="m">*</span> <span class="s">``%(osversion)``</span>: OS version to use

  <span class="m">*</span> see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_osversion`</span>

<span class="m">*</span> <span class="s">``%(post_commands)s``</span>: additional commands for the <span class="s">``post``</span> section of the (Singularity) container recipe


<span class="p">..</span> <span class="nt">_containers_usage_config:</span>

<span class="gh">Container configuration (``--container-config``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

Using <span class="s">``--container-config``</span>, values for specific template values can be specified.

Values can be specified as a comma-separated list of <span class="s">``&lt;key&gt;=&lt;value&gt;``</span> pairs;
for example: <span class="s">``--container-config bootstrap=localimage,from:example.sif``</span>.

Currently supported keywords include:

<span class="m">*</span> <span class="s">``bootstrap``</span>: bootstrap agent to use

  <span class="m">*</span> two types of values are supported:

    <span class="m">*</span> <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_image_based`</span>
    <span class="m">*</span> <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro`</span>

<span class="m">*</span> <span class="s">``eb_args``</span>: additional arguments for &#39;eb&#39; command
<span class="m">*</span> <span class="s">``from``</span>: argument to pass to bootstrap agent

  <span class="m">*</span> <span class="ge">*required/only valid with*</span> <span class="s">``docker``</span>, <span class="s">``library``</span>, <span class="s">``localimage``</span> <span class="ge">*and*</span> <span class="s">``shub``</span> <span class="ge">*bootstrap agents*</span>

  <span class="m">*</span> for more details, see <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_image_based`</span>

<span class="m">*</span> <span class="s">``include``</span>: list of additional OS packages to include

  <span class="m">*</span> see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_include`</span>

<span class="m">*</span> <span class="s">``install_eb``</span>: commands to install EasyBuild
<span class="m">*</span> <span class="s">``mirrorurl``</span>: URI to use to download OS

  <span class="m">*</span> see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_mirrorurl`</span>

<span class="m">*</span> <span class="s">``osversion``</span>: OS version to use

  <span class="m">*</span> see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_osversion`</span>

<span class="m">*</span> <span class="s">``post_commands``</span>: additional commands for <span class="s">``post``</span> section of (Singularity) container recipe

For more details on the last three, see <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro`</span>.

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> Specifying any unknown keywords will results in an error.


<span class="p">..</span> <span class="nt">_container_bootstrap_agent_image_based:</span>

<span class="gh">Image-based bootstrap agents (``docker``, ``library``, ``localimage``, ``shub``)</span>
<span class="gh">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

These bootstrap agents involve using an existing container image as a base.

Supported values include:

<span class="m">*</span> <span class="s">``docker``</span>: base container image hosted on Docker Hub (https://hub.docker.com/)
<span class="m">*</span> <span class="s">``library``</span>: base container image hosted on Sylabs Container Library (https://cloud.sylabs.io/)
<span class="m">*</span> <span class="s">``localimage``</span>: local base container image file
<span class="m">*</span> <span class="s">``shub``</span>: base container image hosted on Singularity Hub (https://singularity-hub.org/)

<span class="gs">**The**</span> <span class="s">``from``</span> <span class="gs">**keyword must also be specified when using one of these bootstrap agents.**</span>

The <span class="s">``localimage``</span> bootstrap agents corresponds to using a local container image file as a base,
where it&#39;s path is specified using the <span class="s">``from``</span> keyword.
For example: &quot;<span class="s">``bootstrap=localimage,from=/home/example/base.sif``</span>&quot;.

Each of the other image-based bootstrap agents imply that the container image to use as a base
is downloaded from the corresponding registry, ad specified through the <span class="s">``from``</span> keyword, with a specific format:

  <span class="m">*</span> for <span class="s">``docker``</span> bootstrap agent: <span class="s">``&lt;registry&gt;/&lt;namespace&gt;/&lt;container&gt;:&lt;tag&gt;@&lt;digest&gt;``</span>
  <span class="m">*</span> for <span class="s">``library``</span> bootstrap agent: <span class="s">``&lt;entity&gt;/&lt;collection&gt;/&lt;container&gt;:&lt;tag&gt;``</span>
  <span class="m">*</span> for <span class="s">``shub``</span> bootstrap agent: <span class="s">``&lt;registry&gt;/&lt;username&gt;/&lt;container-name&gt;:&lt;tag&gt;@digest``</span>

For more details, see https://www.sylabs.io/guides/latest/user-guide/appendix.html#build-modules.


<span class="p">..</span> <span class="nt">_containers_usage_container_base_image_requirements:</span>

<span class="gh">Requirements for base container image</span>
<span class="gh">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

There are a couple of specific requirements for the base container image:

<span class="m">*</span> all dependencies of EasyBuild must be installed, including:

  <span class="m">*</span> Python 2.6 or 2.7
  <span class="m">*</span> Lmod
  <span class="m">*</span> standard tools &amp; utilities like <span class="s">``make``</span>, <span class="s">``patch``</span>, <span class="s">``tar``</span>, etc.
  <span class="m">*</span> OS packages for system libraries like OpenSSL

See also <span class="na">:ref:</span><span class="nv">`requirements`</span>.

Each generated container recipe will include commands to create the <span class="s">``easybuild``</span> user if it doesn&#39;t exist yet,
as well as commands to create the <span class="s">``/app``</span> and <span class="s">``/scratch``</span> directories and give the <span class="s">``easybuild``</span> user
write permissions to those locations.

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> The generated container recipe currently hardcodes some of this.
          We intend to make this more configurable in a future version of EasyBuild.


<span class="p">..</span> <span class="nt">_container_bootstrap_agent_linux_distro:</span>

<span class="gh">Linux distro bootstrap agents (``arch``, ``busybox``, ``debootstrap``, ``yum``, ``zypper``)</span>
<span class="gh">+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>

Dedicated bootstrap agents are supported for different flavors of Linux distributions, including:

<span class="m">*</span> <span class="s">``arch``</span>: Arch Linux
<span class="m">*</span> <span class="s">``busybox``</span>: BusyBox Linux
<span class="m">*</span> <span class="s">``debootstrap``</span>: apt-based systems like Ubuntu/Debian
<span class="m">*</span> <span class="s">``yum``</span>: yum-based systems like CentOS
<span class="m">*</span> <span class="s">``zypper``</span>: zypper-based systems like openSUSE

When one of these bootstrap agents is used, additional keywords can be specified:

<span class="m">*</span> <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_include`</span>
<span class="m">*</span> <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_mirrorurl`</span>
<span class="m">*</span> <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_linux_distro_osversion`</span>

<span class="p">..</span> <span class="nt">_container_bootstrap_agent_linux_distro_include:</span>

<span class="gh">``include`` keyword: OS packages to include</span>
<span class="gh">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

Via the <span class="s">``include``</span> keywords, a list of packages can be specified that should be include on top of the base OS installation.

For some bootstrap agents, a default value is used if no value is specified:

<span class="m">*</span> for the <span class="s">``yum``</span> bootstrap agent: <span class="s">``yum``</span>
<span class="m">*</span> for the <span class="s">``zypper``</span> bootstrap agent: <span class="s">``zypper``</span>

See also https://www.sylabs.io/guides/latest/user-guide/appendix.html#yum-bootstrap-agent and
https://www.sylabs.io/guides/latest/user-guide/appendix.html#zypper-bootstrap-agent.


<span class="p">..</span> <span class="nt">_container_bootstrap_agent_linux_distro_mirrorurl:</span>

<span class="gh">``mirrorurl`` keyword: mirror URL to use to download OS</span>
<span class="gh">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

For most of the Linux distro bootstrap agents (all except <span class="s">``arch``</span>), Singularity requires that a mirror URL
is specified that will be used when downloading the corresponding OS.

You can specify a value using the <span class="s">``mirrorurl``</span> keyword. For example: &quot;<span class="s">``bootstrap=yum,mirrorurl=https://example.com``</span>&quot;.

EasyBuild will use a default value for <span class="s">``mirrorurl``</span> if no other value is specified:

<span class="m">*</span> <span class="s">``busybox``</span>: <span class="s">``https://www.busybox.net/downloads/binaries/%{OSVERSION}/busybox-x86_64``</span>
<span class="m">*</span> <span class="s">``debootstrap``</span>: <span class="s">``http://us.archive.ubuntu.com/ubuntu/``</span>
<span class="m">*</span> <span class="s">``yum``</span>: <span class="s">``http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/x86_64/``</span>
<span class="m">*</span> <span class="s">``zypper``</span>:: <span class="s">``http://download.opensuse.org/distribution/leap/%{OSVERSION}/repo/oss/``</span>


<span class="p">..</span> <span class="nt">_container_bootstrap_agent_linux_distro_osversion:</span>

<span class="gh">``osversion`` keyword: OS version to use</span>
<span class="gh">^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>

Using the <span class="s">``osversion``</span> keyword you can specify which OS version should be installed.

Note that is this only required/used if value for the <span class="s">``mirrorurl``</span> value contains <span class="s">``%{OSVERSION}s``</span>.

For example: &quot;<span class="s">``bootstrap=yum,osversion=7``</span>&quot;.


<span class="p">..</span> <span class="nt">_containers_usage_build_image:</span>

<span class="gh">Building container images (``--container-build-image``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

To instruct EasyBuild to also build a container image from the generated container recipe, use <span class="s">``--container-build-image``</span>
(in combination with <span class="s">``-C``</span> or <span class="s">``--containerize``</span>).

EasyBuild will leverage functionality provided by the container software of choice
(see <span class="na">:ref:</span><span class="nv">`containers_cfg_image_type`</span>) to build the container image.

For example, in the case of Singularity, EasyBuild will run <span class="s">``sudo /path/to/singularity build``</span> on the generated container recipe.

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> In order to leverage the image building functionality of the container software, admin privileges are
          typically required. Therefore, EasyBuild will run the command to build the container image with <span class="s">``sudo``</span>.
          You may need to enter your password to let the command execute.

          EasyBuild will only run the actual container image build command with <span class="s">``sudo``</span>.
          It will not use elevated privileges for anything else.

          In case of doubt, you can use <span class="s">``--extended-dry-run``</span> or <span class="s">``-x``</span> do perform a dry run, so you can evaluate
          which commands will be executed (see also <span class="na">:ref:</span><span class="nv">`extended_dry_run`</span>).

          If you&#39;re not comfortable with this, you can just let EasyBuild generate the container recipe,
          and then use that to build the actual container images yourself, either locally or through
          Singularity Hub (https://singularity-hub.org).

The container image will be placed in the location specified by the <span class="s">``--containerpath``</span> configuration option
(see <span class="na">:ref:</span><span class="nv">`containers_cfg_path`</span>), next to the generated container recipe that was used to build the image.

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span>
    When building container images, make sure to use a file system location with sufficient available storage space.
    Singularity may pull metadata during the build, and each image can range from several hundred MBs to GBs,
    depending on software stack you are including in the container image.

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> EasyBuild will refuse to overwrite existing container images.

          To re-generate an already existing image file, use the <span class="s">``--force``</span> command line option.


<span class="p">..</span> <span class="nt">_containers_usage_example:</span>

<span class="gh">Example usage</span>
<span class="gh">~~~~~~~~~~~~~</span>

In this example, we will use a pre-built base container image located at <span class="s">``example.sif``</span>
(see also <span class="na">:ref:</span><span class="nv">`container_bootstrap_agent_image_based`</span>).

To let EasyBuild generate a container recipe for GCC 6.4.0 + binutils 2.28<span class="se">::</span>

<span class="s">    eb GCC-6.4.0-2.28.eb --containerize --container-config bootstrap=localimage,from=example.sif --experimental</span>

With other configuration options left to default (see output of <span class="s">``eb --show-config``</span>),
this will result in a Singularity container recipe using <span class="s">``example.sif``</span> as base image,
which will be stored in <span class="s">``$HOME/.local/easybuild/containers``</span><span class="se">::</span>

<span class="s">    $ eb GCC-6.4.0-2.28.eb --containerize --container-config bootstrap=localimage,from=example.sif --experimental</span>
<span class="s">    == temporary log file in case of crash /tmp/eb-dLZTNF/easybuild-LPLeG0.log</span>
<span class="s">    == Singularity definition file created at /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28</span>
<span class="s">    == Temporary log file(s) /tmp/eb-dLZTNF/easybuild-LPLeG0.log* have been removed.</span>
<span class="s">    == Temporary directory /tmp/eb-dLZTNF has been removed.</span>

Docker supports a limited set of the container options. Example of commands that can be used to generate
Docker containers are<span class="se">::</span>

<span class="s">    eb  --containerize --container-type=docker --experimental --container-config=ubuntu:20.04 zlib-1.2.11.eb</span>
<span class="s">    eb  --containerize --container-type=docker --experimental --container-config=centos:7 zlib-1.2.11.eb</span>

<span class="p">..</span> <span class="nt">_containers_example_recipe:</span>

<span class="gh">Example of a generated container recipe</span>
<span class="gh">+++++++++++++++++++++++++++++++++++++++</span>

Below is an example of container recipe for that was generated by EasyBuild, using the following command<span class="se">::</span>

<span class="s">    eb Python-3.6.4-foss-2018a.eb -C --container-config bootstrap=yum,osversion=7 --experimental</span>

<span class="p">..</span> <span class="ow">code</span><span class="p">::</span>

    Bootstrap: yum
    OSVersion: 7
    MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/x86_64/
    Include: yum

    %post
    yum install --quiet --assumeyes epel-release
    yum install --quiet --assumeyes python setuptools Lmod
    yum install --quiet --assumeyes python-pip
    yum install --quiet --assumeyes bzip2 gzip tar zip unzip xz
    yum install --quiet --assumeyes curl wget
    yum install --quiet --assumeyes patch make
    yum install --quiet --assumeyes file git which
    yum install --quiet --assumeyes gcc-c++
    yum install --quiet --assumeyes perl-Data-Dumper
    yum install --quiet --assumeyes perl-Thread-Queue
    yum --skip-broken --quiet --assumeyes install libibverbs-dev libibverbs-devel rdma-core-devel
    yum --skip-broken --quiet --assumeyes install openssl-devel libssl-dev libopenssl-devel

    # install EasyBuild using pip
    pip install -U setuptools
    pip install &#39;vsc-install&lt;0.11.4&#39; &#39;vsc-base&lt;2.9.0&#39;
    pip install easybuild

    # create &#39;easybuild&#39; user (if missing)
    id easybuild || useradd easybuild

    # create /app software installation prefix + /scratch sandbox directory
    if [ ! -d /app ]; then mkdir -p /app; chown easybuild:easybuild -R /app; fi
    if [ ! -d /scratch ]; then mkdir -p /scratch; chown easybuild:easybuild -R /scratch; fi

    # install Lmod RC file
    cat &gt; /etc/lmodrc.lua &lt;&lt; EOF
    scDescriptT = {
      {
        [&quot;dir&quot;]       = &quot;/app/lmodcache&quot;,
        [&quot;timestamp&quot;] = &quot;/app/lmodcache/timestamp&quot;,
      },
    }
    EOF

    # change to &#39;easybuild&#39; user
    su - easybuild

    # verbose commands, exit on first error
    set -ve

    # configure EasyBuild

    # use /scratch as general prefix, used for sources, build directories, etc.
    export EASYBUILD_PREFIX=/scratch

    # also use /scratch for temporary directories
    export EASYBUILD_TMPDIR=/scratch/tmp

    # download sources to /scratch/sources, but also consider files located in /tmp/easybuild/sources;
    # that way, source files that can not be downloaded can be seeded in
    export EASYBUILD_SOURCEPATH=/scratch/sources:/tmp/easybuild/sources

    # install software &amp; modules into /app
    export EASYBUILD_INSTALLPATH=/app

    # use EasyBuild to install specified software
    eb Python-3.6.4-foss-2018a.eb --robot

    # update Lmod cache
    mkdir -p /app/lmodcache
    $LMOD_DIR/update_lmod_system_cache_files -d /app/lmodcache -t /app/lmodcache/timestamp /app/modules/all

    # exit from &#39;easybuild&#39; user
    exit

    # cleanup, everything in /scratch is assumed to be temporary
    rm -rf /scratch/*

    %runscript
    eval &quot;$@&quot;

    %environment
    # make sure that &#39;module&#39; and &#39;ml&#39; commands are defined
    source /etc/profile
    # increase threshold time for Lmod to write cache in $HOME (which we don&#39;t want to do)
    export LMOD_SHORT_TIME=86400
    # purge any modules that may be loaded outside container
    module --force purge
    # avoid picking up modules from outside of container
    module unuse $MODULEPATH
    # pick up modules installed in /app
    module use /app/modules/all
    # load module(s) corresponding to installed software
    module load Python/3.6.4-foss-2018a

    %labels


The generated container recipe includes a bunch of <span class="s">``yum install``</span> commands to install additional required/useful OS packages,
<span class="s">``pip install``</span> commands to install EasyBuild (if it&#39;s not installed yet), commands to create the <span class="s">``easybuild``</span> user
and provide write access to the <span class="s">``/app``</span> and <span class="s">``/scratch``</span> directories, and to configure Lmod and update the Lmod cache
after software was installed with EasyBuild.

In addition, the generated module files will follow the default module naming scheme (<span class="s">``EasyBuildMNS``</span>).
The modules that correspond to the easyconfig files that were specified on the command line will be loaded
automatically, see the statements in the <span class="s">``%environment``</span> section of the generated container recipe.


<span class="p">..</span> <span class="nt">_containers_example_build_image:</span>

<span class="gh">Example of building container image</span>
<span class="gh">+++++++++++++++++++++++++++++++++++</span>

You can instruct EasyBuild to also build the container image by also using <span class="s">``--container-build-image``</span>.

Note that you will need to enter your <span class="s">``sudo``</span> password (unless you recently executed a <span class="s">``sudo``</span> command
in the same shell session)<span class="se">::</span>

<span class="s">    $ eb GCC-6.4.0-2.28.eb --containerize --container-config bootstrap=localimage,from=/tmp/example.sif --container-build-image --experimental</span>
<span class="s">    == temporary log file in case of crash /tmp/eb-aYXYC8/easybuild-8uXhvu.log</span>
<span class="s">    == Singularity tool found at /usr/bin/singularity</span>
<span class="s">    == Singularity version &#39;2.4.6&#39; is 2.4 or higher ... OK</span>
<span class="s">    == Singularity definition file created at /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28</span>
<span class="s">    == Running &#39;sudo /usr/bin/singularity build  /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28&#39;, you may need to enter your &#39;sudo&#39; password...</span>
<span class="s">    == (streaming) output for command &#39;sudo /usr/bin/singularity build  /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28&#39;:</span>
<span class="s">    Using container recipe deffile: /home/example/.local/easybuild/containers/Singularity.GCC-6.4.0-2.28</span>
<span class="s">    Sanitizing environment</span>
<span class="s">    Adding base Singularity environment to container</span>
<span class="s">    ...</span>
<span class="s">    == temporary log file in case of crash /scratch/tmp/eb-WnmCI_/easybuild-GcKyY9.log</span>
<span class="s">    == resolving dependencies ...</span>
<span class="s">    ...</span>
<span class="s">    == building and installing GCCcore/6.4.0...</span>
<span class="s">    ...</span>
<span class="s">    == building and installing binutils/2.28-GCCcore-6.4.0...</span>
<span class="s">    ...</span>
<span class="s">    == building and installing GCC/6.4.0-2.28...</span>
<span class="s">    ...</span>
<span class="s">    == COMPLETED: Installation ended successfully</span>
<span class="s">    == Results of the build can be found in the log file(s) /app/software/GCC/6.4.0-2.28/easybuild/easybuild-GCC-6.4.0-20180424.084946.log</span>
<span class="s">    == Build succeeded for 15 out of 15</span>
<span class="s">    ...</span>
<span class="s">    Building Singularity image...</span>
<span class="s">    Singularity container built: /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif</span>
<span class="s">    Cleaning up...</span>
<span class="s">    == Singularity image created at /home/example/.local/easybuild/containers/GCC-6.4.0-2.28.sif</span>
<span class="s">    == Temporary log file(s) /tmp/eb-aYXYC8/easybuild-8uXhvu.log* have been removed.</span>
<span class="s">    == Temporary directory /tmp/eb-aYXYC8 has been removed.</span>


The inspect the container image, you can use <span class="s">``singularity shell``</span> to start a shell session <span class="ge">*in*</span> the container<span class="se">::</span>

<span class="s">    $ singularity shell --shell &quot;/bin/bash --norc&quot; $HOME/.local/easybuild/containers/GCC-6.4.0-2.28.sif</span>

<span class="s">    Singularity GCC-6.4.0-2.28.sif:~&gt; module list</span>

<span class="s">    Currently Loaded Modules:</span>
<span class="s">      1) GCCcore/6.4.0   2) binutils/2.28-GCCcore-6.4.0   3) GCC/6.4.0-2.28</span>

<span class="s">    Singularity GCC-6.4.0-2.28.sif:~&gt; which gcc</span>
<span class="s">    /app/software/GCCcore/6.4.0/bin/gcc</span>

<span class="s">    Singularity GCC-6.4.0-2.28.sif:~&gt; gcc --version</span>
<span class="s">    gcc (GCC) 6.4.0</span>
<span class="s">    ...</span>


<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> We are passing <span class="s">``--shell &quot;/bin/bash --norc``</span> to <span class="s">``singularity shell``</span> to avoid that the <span class="s">``.bashrc``</span> login
          script that may be present in your home directory is sourced, since that may include statements that are
          not relevant in the container environment.


Or, you can use <span class="s">``singularity exec``</span> to execute a command in the container.

Compare the output of running <span class="s">``which gcc``</span> and <span class="s">``gcc --version``</span> locally<span class="se">::</span>

<span class="s">    $ which gcc</span>
<span class="s">    /usr/bin/gcc</span>
<span class="s">    $ gcc --version</span>
<span class="s">    gcc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-16)</span>
<span class="s">    ...</span>

and the output when running the same commands in the container<span class="se">::</span>

<span class="s">    $ singularity exec GCC-6.4.0-2.28.sif which gcc</span>
<span class="s">    /app/software/GCCcore/6.4.0/bin/gcc</span>

<span class="s">    $ singularity exec GCC-6.4.0-2.28.sif gcc --version</span>
<span class="s">    gcc (GCC) 6.4.0</span>
<span class="s">    ...</span>


<span class="gh">Configuration</span>
<span class="gh">-------------</span>

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> You can specify each of these configuration options either as options to the <span class="s">``eb``</span> command,
          via the equivalent <span class="s">``$EASYBUILD_CONTAINER*``</span> environment variable, or via an EasyBuild configuration file;
          see <span class="na">:ref:</span><span class="nv">`configuration_types`</span>.

<span class="p">..</span> <span class="nt">_containers_cfg_path:</span>

<span class="gh">Location for generated container recipes &amp; images (``--containerpath``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

To control the location where EasyBuild will put generated container recipes &amp; images, use the <span class="s">``--containerpath``</span>
configuration setting. Next to providing this as an option to the <span class="s">``eb``</span> command, you can also define
the <span class="s">``$EASYBUILD_CONTAINERPATH``</span> environment variable or specify <span class="s">``containerpath``</span> in an EasyBuild configuration file.

The default value for this location is <span class="s">``$HOME/.local/easybuild/containers``</span>, unless the <span class="s">``--prefix``</span> configuration
setting was provided, in which case it becomes <span class="s">``&lt;prefix&gt;/containers``</span> (see <span class="na">:ref:</span><span class="nv">`prefix`</span>).

Use <span class="s">``eb --show-full-config | grep containerpath``</span> to determine the currently active setting.


<span class="p">..</span> <span class="nt">_containers_cfg_image_format:</span>

<span class="gh">Container image format (``--container-image-format``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="p">..</span> <span class="ow">note</span><span class="p">::</span> This is only relevant when creating Singularity container images;
          the value for <span class="s">``--container-image-format``</span> is ignored when creating Docker container images.

The format for container images that EasyBuild is produces via the functionality provided by the container software
can be controlled via the <span class="s">``--container-image-format``</span> configuration setting.

For Singularity containers (see <span class="na">:ref:</span><span class="nv">`containers_cfg_type`</span>), three image formats are supported:

<span class="m">*</span> <span class="s">``squashfs``</span> <span class="ge">*(default when using Singularity 2.x)*</span>: compressed images using <span class="s">``squashfs``</span> read-only file system
<span class="m">*</span> <span class="s">``sif``</span> <span class="ge">*(default when using Singularity 3.x)*</span>: compressed read-only Singularity Image File (SIF)
<span class="m">*</span> <span class="s">``ext3``</span>: writable image file using <span class="s">``ext3``</span> file system <span class="ge">*(only supported with Singularity 2.x)*</span>
<span class="m">*</span> <span class="s">``sandbox``</span>: container image in a regular directory

See also https://www.sylabs.io/guides/latest/user-guide/build_a_container.html .


<span class="p">..</span> <span class="nt">_containers_cfg_image_name:</span>

<span class="gh">Name for container recipe &amp; image (``--container-image-name``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

By default, EasyBuild will use the name of the first easyconfig file (without the <span class="s">``.eb``</span> suffix) as a name
for both the container recipe and image.

You can specify an altername name using the <span class="s">``--container-image-name``</span> configuration setting.

The filename of generated container recipe will be <span class="s">``Singularity.&lt;name&gt;``</span>.

The filename of the container image will be <span class="s">``&lt;name&gt;&lt;extension&gt;``</span>,
where the value for <span class="s">``&lt;extension&gt;``</span> depends on the image format (see <span class="na">:ref:</span><span class="nv">`containers_cfg_image_format`</span>):

<span class="m">*</span> &#39;<span class="s">``.simg``</span>&#39; for <span class="s">``squashfs``</span> Singularity container images <span class="ge">*(only with Singularity 2.x)*</span>
<span class="m">*</span> &#39;<span class="s">``.img``</span>&#39; for <span class="s">``ext3``</span> Singularity container images <span class="ge">*(only with Singularity 2.x)*</span>
<span class="m">*</span> &#39;<span class="s">``.sif``</span>&#39; for Singularity container images in Singularity Image Format (SIF) <span class="ge">*(only with Singularity 3.x)*</span>
<span class="m">*</span> <span class="ge">*empty*</span> for <span class="s">``sandbox``</span> Singularity container images (in which case the container image is actually a directory rather than a file)
<span class="m">*</span> <span class="ge">*empty*</span> for Docker container images


<span class="p">..</span> <span class="nt">_containers_tmpdir:</span>

<span class="gh">Temporary directory for creating container images (``--container-tmpdir``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

The container software that EasyBuild leverages to build container images may be using
a temporary directory in a location that doesn&#39;t have sufficient free space.

You can instruct EasyBuild to pass an alternate location via the <span class="s">``--container-tmpdir``</span> configuration setting.

For Singularity, the default is to use <span class="s">``/tmp``</span>, see https://www.sylabs.io/guides/latest/user-guide/build_env.html#temporary-folders.
If <span class="s">``--container-tmpdir``</span> is specified, the <span class="s">``$SINGULARITY_TMPDIR``</span> environment variable will be defined accordingly
to let Singularity use that location instead.


<span class="p">..</span> <span class="nt">_containers_cfg_type:</span>

<span class="gh">Type of container recipe/image to generate (``--container-type``)</span>
<span class="gh">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

With the <span class="s">``--container-type``</span> configuration option, you can specify what type of container recipe/image EasyBuild
should generated. Possible values are:

<span class="m">*</span> <span class="s">``docker``</span>: Docker (https://docs.docker.com/) container recipe &amp; images (supported since EasyBuild v3.6.2)
<span class="m">*</span> <span class="s">``singularity``</span> <span class="ge">*(default)*</span>: Singularity (https://www.sylabs.io/singularity) container recipes &amp; images


<span class="p">..</span> <span class="nt">_containers_stacking:</span>

<span class="gh">&#39;Stacking&#39; container images</span>
<span class="gh">---------------------------</span>

To avoid long build times and excessive large container images, you can construct your target container image
step-by-step, by first building a base container image for the compiler toolchain you want to use,
and then using it to build a container images for a particular (set of) software package(s).

For example, to build a container image for Python 3.6.4 built with the <span class="s">``foss/2018a``</span> toolchain<span class="se">::</span>

<span class="s">    $ cd /tmp</span>

<span class="s">    # use current directory as location for generated container recipes &amp; images</span>
<span class="s">    $ export EASYBUILD_CONTAINERPATH=$PWD</span>

<span class="s">    # build base container image for OpenMPI + GCC parts of foss/2018a toolchain, on top of CentOS 7.4 base image</span>
<span class="s">    $ eb -C --container-build-image OpenMPI-2.1.2-GCC-6.4.0-2.28.eb --container-config bootstrap=yum,osversion=7 --experimental</span>
<span class="s">    ...</span>
<span class="s">    == Singularity image created at /tmp/OpenMPI-2.1.2-GCC-6.4.0-2.28.sif</span>
<span class="s">    ...</span>

<span class="s">    $ ls -lh OpenMPI-2.1.2-GCC-6.4.0-2.28.sif</span>
<span class="s">    -rwxr-xr-x 1 root root 590M Apr 24 11:43 OpenMPI-2.1.2-GCC-6.4.0-2.28.sif</span>

<span class="s">    # build another container image for the for the full foss/2018a toolchain, using the OpenMPI + GCC container as a base</span>
<span class="s">    $ eb -C --container-build-image foss-2018a.eb --container-config bootstrap=localimage,from=OpenMPI-2.1.2-GCC-6.4.0-2.28.sif --experimental</span>
<span class="s">    ...</span>
<span class="s">    == Singularity image created at /tmp/foss-2018a.sif</span>
<span class="s">    ...</span>

<span class="s">    $ ls -lh foss-2018a.sif</span>
<span class="s">    -rwxr-xr-x 1 root root 614M Apr 24 13:11 foss-2018a.sif</span>

<span class="s">    # build container image for Python 3.6.4 with foss/2018a toolchain by leveraging base container image foss-2018a.sif</span>
<span class="s">    $ eb -C --container-build-image Python-3.6.4-foss-2018a.eb --container-config bootstrap=localimage,from=foss-2018a.sif --experimental</span>
<span class="s">    ...</span>
<span class="s">    == Singularity image created at /tmp/Python-3.6.4-foss-2018a.sif</span>
<span class="s">    ...</span>

<span class="s">    $ ls -lh Python-3.6.4-foss-2018a.sif</span>
<span class="s">    -rwxr-xr-x 1 root root 759M Apr 24 14:01 Python-3.6.4-foss-2018a.sif</span>

<span class="s">    $ singularity exec Python-3.6.4-foss-2018a.sif which python</span>
<span class="s">    /app/software/Python/3.6.4-foss-2018a/bin/python</span>

<span class="s">    $ singularity exec Python-3.6.4-foss-2018a.sif python -V</span>
<span class="s">    vsc40023 belongs to gsingularity</span>
<span class="s">    Python 3.6.4</span>


<span class="p">..</span> <span class="nt">_containers_stacking:</span>

<span class="gh">Seeding in source files for container build process</span>
<span class="gh">---------------------------------------------------</span>

In some cases, you may need to &quot;seed in&quot; manually downloaded source files into the container build environment,
because the sources can not be downloaded automatically.

As shown in <span class="na">:ref:</span><span class="nv">`containers_example_recipe`</span>, the container recipe generated by EasyBuild
includes <span class="s">``/tmp/easybuild/sources/``</span> as a fallback directory in the list of locations considered by EasyBuild
when looking for sources/patches (see also <span class="na">:ref:</span><span class="nv">`sourcepath`</span>).

That way, you can copy source files that should be available when building the container image into <span class="s">``/tmp/easybuild/sources/``</span>.
</code></pre></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">October 24, 2022</span>
      
    
  </small>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/easy_build" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.youtube.com/c/easybuilders" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://docs.easybuild.io" target="_blank" rel="noopener" title="docs.easybuild.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["instant"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>